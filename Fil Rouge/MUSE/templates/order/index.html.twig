{% extends 'base.html.twig' %}

{% block title %}Commande
{% endblock %}

{% block body %}
<body id="orderBody">
	<style>
		body {
			background: url('/img/BG22.png') no-repeat;
			background-size: 80rem 60rem;
			background-repeat: repeat;
		}
	</style>

	<div class="container">

		<h1 class="text-center mt-3 mb-5">Votre commande :</h1>

		{# *** USER CART INFORMATION *** #}
		<h3 class="text-center  mt-5 mb-3">
			Votre panier :</h3>

		<table class="table table-dark border border-info">
			<thead>
				<tr class="text-primary">
					<th id="audioFont" class="surround">Produit</th>
					<th id="audioFont" class="surround">Prix</th>
					<th id="audioFont" class="surround">Promotion</th>
					<th id="audioFont" class="surround">TVA</th>
					<th id="audioFont" class="surround">Quantité</th>
					<th id="audioFont" class="surround">Sous-total</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				{% for item in items %}
					<tr>
						<td>
							<a class="text-decoration-none" href="{{ path('app_product_show', {'id': item.product.id}) }}">
								<p class="productHl">{{item.Product.name}}</p>
							</a>
						</td>
						<td>{{item.Product.price}}
						</td>
						{% if item.product.discount %}<td class="text text-warning"><div class="d-flex justify-content-start">
				<h4 class="text-warning roboto">-{{ item.product.discountRate * 100 }}</h4><h5 class="text-warning">%</h5></div>{% else %}<td>-{% endif %}</td>
							<td>{{ app.user.vat * 100}}%
							</td>
							<td>{{item.Quantity}}
								{% if item.product.quantity == 0 %}
									({{item.product.quantity}}
									left in stock)
								{% endif %}
							</td>
							<td class="roboto h4{% if item.product.discount %} text-warning{% endif %}">{{ ((item.Product.price * item.Quantity) * (1 - ( item.product.discountRate)) * (1 +  app.user.vat ))|number_format(2, '.', '') }}
								€
							</td>
							<td>
								<a href="{{ path("app_cart_add", {id: item.product.id}) }}" title="Ajouter 1" class="btn btn-success btn-sm {% if item.product.quantity == 0 %} disabled {% endif %}">
									<i class="bi bi-cart-plus"></i>
								</a>
								<a href="{{ path("app_cart_remove", {id: item.product.id}) }}" title="Retirer 1" class="btn btn-primary btn-sm">
									<i class="bi bi-cart-dash"></i>
									<a href="{{ path ('app_cart_delete', {'id': item.product.id}) }}" title="Retirer la ligne" class="btn btn-danger ml-1 btn-sm">
										<i class="fas fa-trash"></i>
									</a>
								</td>
							</td>
						</tr>
					{% endfor %}
				</tbody>
			</tbody>
			<tfoot>
				<tr>
					<td colspan="3" class="text-right surround h3">
						<b class="roboto">Total :</b>
					</td>
					<td class="roboto h3">{{ total|number_format(2, '.', '') }}
						€
					</td>
					<td colspan="5">
						<a href="{{ path("app_cart_deleteAll") }}" class="btn btn-danger" title="Supprimer le panier">
							<i class="bi bi-cart-x"></i>
						</a>
					</td>
				</tr>
				<tr class="text-center">
					<td class="roboto" colspan="8">Date de la commande :
						<b>{{ "now" | date('d-m-Y') }}</b>
					</td>
				</tr>
			</tfoot>
		</table>

		{# *** COUPON FORM *** #}
		<div class="text-center">
			<button id="couponButton" class="btn btn-outline-primary btn-xs productHl" onclick="addCoupon()">
				Code promo
			</button>
		</div>

		<div id="couponInput">
			<div class="d-flex justify-content-center mt-2">
				<form action="" method="POST" class="form-inline">
					<div class="form-group">
						<div class="input-group">
							<i class="fa-solid fa-gift fa-lg mt-2 mr-1 surround"></i>
							<input type="text" name="code" autocomplete="off" class="form-control" placeholder="Code promo?"/>
						</div>
						<button type="submit" class="btn btn-primary border-light">Ajouter</button>
					</div>
				</form>
			</div>
		</div>

		{# *** USER PERSONNAL INFORMATION *** #}
		<h3 class="text-center mt-5 mb-3">
			Vos informations personnelles :</h3>

		<div class="row">
			<div class="col-md-6">
				<div class="d-flex justify-content-center">
					<div class="card border-secondary bg-dark text-light mb-5 mt-3 rounded" style="width: 30rem;">
						<i class="fa-solid fa-address-card fa-lg text-center mt-3"></i>
						<div class="card-body">
							<h5 class="card-title text-info text-center">{{ app.user.email }}</h5>
						</div>
						<ul class="list-group list-group-flush">
							<li class="list-group-item bg-dark text-light">
								<b id="audioFont" class="surround">Prénom :</b>
								{{ app.user.userName }}</li>
							<li class="list-group-item bg-dark text-light">
								<b id="audioFont" class="surround">Nom :</b>
								{{ app.user.userLastname }}</li>
							<li class="list-group-item bg-dark text-light">
								<b id="audioFont" class="surround">Date de naissance :</b>
								{{ app.user.birthdate ? app.user.birthdate|date('d-m-Y') : '' }}</li>

							<li class="list-group-item bg-dark text-light">
								<b id="audioFont" class="surround">N° téléphone :</b>
								{{ app.user.phoneNumber }}</li>
							<li class="list-group-item bg-dark text-light">
								<b id="audioFont" class="surround">Votre compte est vérifié :</b>
								{{ app.user.isVerified ? 'Oui' : 'Non' }}</li>
							<li class="list-group-item bg-dark text-light">
								<div class='text-center'>
									<b id="audioFont" class="surround">Adresse(s) :</b>
								</div>
								<br>
								{% for address in addresses %}-<b>
										{{ address.name }}
										{% if address.billingAddress %}
											<b class="text-warning">
												(Facturation)
											{% elseif address.deliveryAddress %}
												<b class="text-warning">
													(Livraison)
												{% endif %}
											</b>
											:</b>
										<i>{{ address.pathNumber }},
											{{ address.pathType }}
											{{ address.zipcode }}
											{{ address.city }},
											{{ address.country }}</i><br>
									{% endfor %}
									<div class='text-center'>
										<a href="{{ path('app_client_address_index') }}" class="mt-2 mb-1 btn-sm">
											<i class="fa-solid fa-pencil btn btn-warning border border-light mt-3 mb-1" title="Modifier vos adresses"></i>
										</a>
									</div>
								</li>
							</li>
						</ul>
						<div class="card-body text-center">
							<a class="text-decoration-none text-light" href="{{ path('app_client_edit', {'id': app.user.id}) }}">
								<i class="fa-solid fa-pencil btn btn-info border border-light" title="Modifier votre profil"></i>
							</a>
						</div>
					</div>
				</div>
			</div>
			{# *** USER ADDRESS SELECTION FORM *** #}
			<div class="text-center col-md-6 mt-5 d-flex align-items-center">
				{{ include('order/_selectForm.html.twig') }}
			</div>
		</div>

		{# *** NEW ADDRESS FORM *** #}
		<div class="text-center mb-5">
			<button class="btn btn-primary border-light btn-md text-center mt-3 productHl" id="newAddressButton" onclick="newAddress()">Ajouter une adresse ?</button>
			<br><small class="text-light">(Domicile, facturation, livraison, ...)
			</small>
		</div>
		{# <div class="text-center bg-muted mt-1">
										<div class="form-check">
											<input type="checkbox" id="newAddress" class="form-check-input" value="1" onclick="newAddress()">
											<label class="form-check-label" for="newAddress">Ajouter une adresse ?</label>
											<small id="newAddressHelp" class="form-text text-light mb-5">(Domicile, facturation, livraison, ...)
											</small>
										</div>
									</div> #}
		<div id="newAddressForm">
			{{ include('order/_newAddressForm.html.twig') }}
		</div>

		{# *** PAYMENT CARD FORM *** #}
		<div class="text-center">
			<button class="btn btn-primary border-light btn-lg text-center productHl" id="payCardButton" onclick="payCard()">Paiement par carte</button>
		</div>

		<div id="payCardForm">
			<div class="container">
				<div class="row">
					<div class="col">
						{{ include('order/_payCardForm.html.twig') }}
					</div>
				</div>
			</div>
		</div>

		<div class="text-center mt-2">
			<button class="btn btn-primary border-light btn-lg text-center">
				<a class="text-decoration-none text-light" href="{{ path('app_test') }}">Pdf Test</a>
			</button>
		</div>


		{# *** STRIPE PAYMENT CARD FORM *** #}
		<div class="text-center">
			<div class="btn btn-primary btn-lg border-light mt-3 mb-3">
				<form action="{{ path("app_order_validated") }}" method="POST">
					<script src="https://checkout.stripe.com/checkout.js" class="stripe-button" data-key="pk_test_HxZzNHy8LImKK9LDtgMDRBwd" data-amount="{{ total * 100 }}" data-name="Muse check-out" data-description="(4242 4242 4242 4242+any CVC/valid future expiration)" data-image="/img/logo.png" data-locale="auto"></script>
				</form>
			</div>
		</div>
		<div class="text-center">
			<small class="text-info">(Card number: 4242 4242 4242 4242 + any CVC/valid future expiration)</small>
		</div>

	</div>
</body>
{% endblock %}
